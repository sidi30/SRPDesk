# ============================================================================
# SRPDesk — Configuration entreprise
# ============================================================================
# Copiez ce fichier en .env et adaptez les valeurs à votre infrastructure.
# Les variables marquées REQUIRED n'ont pas de valeur par défaut sûre.
# ============================================================================

# ---------- Docker images ----------
IMAGE_PREFIX=ghcr.io/your-org/srpdesk
IMAGE_TAG=latest

# ---------- PostgreSQL ----------
POSTGRES_DB=srpdesk
POSTGRES_USER=srpdesk
POSTGRES_PASSWORD=changeme                    # REQUIRED — mot de passe BDD

# ---------- Keycloak ----------
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=changeme              # REQUIRED — mot de passe admin Keycloak
KC_HOSTNAME=auth.srpdesk.com

# ---------- MinIO (S3) ----------
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=changeme                  # REQUIRED — mot de passe MinIO

# ============================================================================
# Backend
# ============================================================================

# --- Base de données ---
DB_HOST=postgres
DB_PORT=5432
DB_NAME=srpdesk
DB_USER=srpdesk
DB_PASSWORD=changeme                          # REQUIRED — doit correspondre à POSTGRES_PASSWORD
DB_POOL_MAX=30                                # Taille max du pool Hikari (défaut prod: 30)
DB_POOL_MIN=10                                # Connexions idle minimum (défaut prod: 10)
DB_POOL_CONNECTION_TIMEOUT=20000              # Timeout connexion pool en ms (défaut: 20000)

# --- OIDC (Keycloak) ---
KEYCLOAK_ISSUER_URI=https://auth.srpdesk.com/realms/srpdesk
KEYCLOAK_JWK_URI=http://keycloak:8080/realms/srpdesk/protocol/openid-connect/certs

# --- S3 (MinIO) ---
S3_ENDPOINT=http://minio:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=changeme                        # REQUIRED — doit correspondre à MINIO_ROOT_PASSWORD
S3_BUCKET=evidences
S3_REGION=us-east-1

# --- Core applicatif ---
SERVER_PORT=8080                              # Port du serveur backend
CORS_ORIGINS=https://app.srpdesk.com          # Origines CORS autorisées (séparées par virgules)
SPRING_PROFILES_ACTIVE=prod
APP_NAME=srpdesk                              # Nom affiché dans les métriques
MAX_FILE_SIZE=50MB                            # Taille max par fichier uploadé
MAX_REQUEST_SIZE=55MB                         # Taille max de la requête multipart

# --- Tomcat ---
TOMCAT_MAX_THREADS=200                        # Threads max Tomcat (défaut prod: 200)
TOMCAT_ACCEPT_COUNT=100                       # File d'attente Tomcat (défaut prod: 100)

# --- Rate limiting ---
RATE_LIMIT_ENABLED=true                       # Activer le rate limiting global
RATE_LIMIT_RPM=60                             # Requêtes par minute (API générale, prod: 60)
RATE_LIMIT_CVD_RPM=5                          # Requêtes par minute (CVD public, prod: 5)

# --- Email / SMTP ---
EMAIL_ENABLED=false                           # Activer l'envoi d'emails
EMAIL_FROM=noreply@srpdesk.com                # Adresse expéditeur
SMTP_HOST=                                    # Serveur SMTP (ex: smtp.gmail.com)
SMTP_PORT=587                                 # Port SMTP
SMTP_USERNAME=                                # Utilisateur SMTP
SMTP_PASSWORD=                                # Mot de passe SMTP
SMTP_AUTH=false                               # Authentification SMTP requise
SMTP_STARTTLS=true                            # Activer STARTTLS

# --- CRA (notifications & escalation) ---
CRA_NOTIFICATION_CHECK_MS=900000              # Intervalle vérification notifications (ms, défaut: 15 min)
CRA_ESCALATION_CHECK_MS=300000                # Intervalle vérification escalation (ms, défaut: 5 min)
CRA_ALERT_EMAIL=                              # Email alertes CRA
CRA_ESCALATION_EMAIL=                         # Email escalation CRA

# --- ENISA SRP ---
ENISA_ENABLED=false                           # Activer le connecteur ENISA SRP
ENISA_BASE_URL=https://srp.enisa.europa.eu
ENISA_API_KEY=                                # Clé API ENISA
ENISA_TIMEOUT=30                              # Timeout secondes

# --- CSIRT national (Art. 14) ---
CSIRT_ENABLED=false                           # Activer la notification CSIRT parallèle
CSIRT_BASE_URL=                               # URL de l'API CSIRT nationale
CSIRT_API_KEY=                                # Clé API CSIRT
CSIRT_TIMEOUT=30                              # Timeout secondes
CSIRT_COUNTRY_CODE=FR                         # Code pays ISO (défaut: FR)

# --- Monitoring vulnérabilités (OSV) ---
MONITORING_INTERVAL_MS=21600000               # Intervalle de scan (ms, défaut: 6h)
OSV_BASE_URL=https://api.osv.dev
OSV_BATCH_SIZE=100                            # Taille des lots OSV
OSV_RATE_LIMIT_MS=1000                        # Pause entre lots (ms)

# --- CVD (Coordinated Vulnerability Disclosure) ---
CVD_CONTACT_EMAIL=security@srpdesk.com        # Email de contact sécurité (security.txt)

# --- Support end-of-life monitoring ---
SUPPORT_MONITOR_WARNING_DAYS=90               # Jours avant fin de support pour alerter

# --- AI / Ollama ---
AI_ENABLED=false                              # Activer l'assistant IA
OLLAMA_BASE_URL=http://ollama:11434           # URL du serveur Ollama
OLLAMA_MODEL=phi3.5                           # Modèle LLM
OLLAMA_TEMPERATURE=0.2                        # Température (0.0–1.0)
OLLAMA_TOP_P=0.9                              # Top-P sampling
OLLAMA_NUM_CTX=4096                           # Taille du contexte (tokens)
OLLAMA_TIMEOUT=120                            # Timeout secondes
AI_RATE_LIMIT_RPM=10                          # Requêtes IA par minute

# --- Webhooks & intégrations ---
GITHUB_WEBHOOK_SECRET=                        # Secret HMAC-SHA256 webhook GitHub
GITLAB_WEBHOOK_SECRET=                        # Secret webhook GitLab

# --- API Keys ---
API_KEY_PREFIX=srpd_                           # Préfixe des clés API générées
API_KEY_LENGTH=20                             # Longueur aléatoire des clés (octets)
API_KEY_SCOPES=ci:sbom                        # Scopes par défaut

# --- SBOM ---
SBOM_MAX_SIZE_MB=10                           # Taille max SBOM uploadé (MB)

# --- Feature flags backend ---
EXTRAS_REQUIREMENTS_ENABLED=false             # CRA checklist module
EXTRAS_QUESTIONNAIRE_ENABLED=false            # AI questionnaire module

# --- Observabilité (OpenTelemetry) ---
OTEL_SAMPLING_PROBABILITY=1.0                 # Probabilité de sampling traces (0.0–1.0, prod: 1.0)
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces  # Endpoint OTLP collector

# --- JVM tuning ---
JAVA_OPTS=                                    # Options JVM (ex: -Xms512m -Xmx1g -XX:+UseG1GC)

# ============================================================================
# Frontend (variables build-time Vite)
# ============================================================================
VITE_KEYCLOAK_URL=https://auth.srpdesk.com
VITE_KEYCLOAK_REALM=srpdesk
VITE_KEYCLOAK_CLIENT_ID=frontend
VITE_API_URL=/api/v1                          # URL de base API (défaut: /api/v1 via proxy nginx)
VITE_FEATURE_REQUIREMENTS=false               # Activer le module CRA checklist (frontend)
VITE_FEATURE_AI_QUESTIONNAIRE=false           # Activer le module questionnaire IA (frontend)

# ============================================================================
# Docker Compose opérationnel
# ============================================================================
FRONTEND_PORT=80                              # Port exposé pour le frontend
LANDING_PORT=3001                             # Port exposé pour le site vitrine
POSTGRES_MEMORY_LIMIT=512m                    # Limite mémoire conteneur PostgreSQL
KEYCLOAK_MEMORY_LIMIT=768m                    # Limite mémoire conteneur Keycloak
MINIO_MEMORY_LIMIT=256m                       # Limite mémoire conteneur MinIO
BACKEND_MEMORY_LIMIT=768m                     # Limite mémoire conteneur backend
