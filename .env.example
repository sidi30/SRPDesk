# ============================================================================
# SRPDesk — Configuration entreprise
# ============================================================================
# Copiez ce fichier en .env et adaptez les valeurs a votre infrastructure.
# Les variables marquees REQUIRED n'ont pas de valeur par defaut sure.
# ============================================================================

# ---------- Docker images ----------
IMAGE_PREFIX=ghcr.io/your-org/srpdesk
IMAGE_TAG=latest

# ---------- Domaines (REQUIRED) ----------
APP_DOMAIN=app.srpdesk.com                   # REQUIRED — domaine de l'application
AUTH_DOMAIN=auth.srpdesk.com                 # REQUIRED — domaine Keycloak
LANDING_DOMAIN=www.srpdesk.com               # Domaine du site vitrine
MONITORING_DOMAIN=monitoring.srpdesk.com     # Domaine Prometheus (protege par basicauth)

# ---------- Reverse proxy Caddy ----------
ACME_EMAIL=admin@srpdesk.com                 # Email pour Let's Encrypt (certificats TLS)
MONITORING_USER=admin                        # Utilisateur basicauth pour Prometheus
MONITORING_PASSWORD_HASH=                    # REQUIRED — hash bcrypt du mot de passe monitoring
                                             # Generer avec : caddy hash-password --plaintext 'votre-mot-de-passe'
                                             # ou : docker run --rm caddy:2-alpine caddy hash-password --plaintext 'votre-mot-de-passe'

# ---------- PostgreSQL ----------
POSTGRES_DB=srpdesk
POSTGRES_USER=srpdesk
POSTGRES_PASSWORD=changeme                   # REQUIRED — mot de passe BDD

# ---------- Keycloak ----------
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=changeme             # REQUIRED — mot de passe admin Keycloak

# ---------- MinIO (S3) ----------
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=changeme                 # REQUIRED — mot de passe MinIO

# ============================================================================
# Backend
# ============================================================================

# --- Base de donnees ---
DB_HOST=postgres
DB_PORT=5432
DB_NAME=srpdesk
DB_USER=srpdesk
DB_PASSWORD=changeme                         # REQUIRED — doit correspondre a POSTGRES_PASSWORD
DB_POOL_MAX=30                               # Taille max du pool Hikari (defaut prod: 30)
DB_POOL_MIN=10                               # Connexions idle minimum (defaut prod: 10)
DB_POOL_CONNECTION_TIMEOUT=20000             # Timeout connexion pool en ms (defaut: 20000)

# --- OIDC (Keycloak) ---
KEYCLOAK_ISSUER_URI=https://auth.srpdesk.com/realms/srpdesk
KEYCLOAK_JWK_URI=http://keycloak:8080/realms/srpdesk/protocol/openid-connect/certs

# --- S3 (MinIO) ---
S3_ENDPOINT=http://minio:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=changeme                       # REQUIRED — doit correspondre a MINIO_ROOT_PASSWORD
S3_BUCKET=evidences
S3_REGION=us-east-1

# --- Core applicatif ---
SERVER_PORT=8080                             # Port du serveur backend
CORS_ORIGINS=https://app.srpdesk.com         # Origines CORS autorisees (separees par virgules)
SPRING_PROFILES_ACTIVE=prod
APP_NAME=srpdesk                             # Nom affiche dans les metriques
MAX_FILE_SIZE=50MB                           # Taille max par fichier uploade
MAX_REQUEST_SIZE=55MB                        # Taille max de la requete multipart

# --- Tomcat ---
TOMCAT_MAX_THREADS=200                       # Threads max Tomcat (defaut prod: 200)
TOMCAT_ACCEPT_COUNT=100                      # File d'attente Tomcat (defaut prod: 100)

# --- Rate limiting ---
RATE_LIMIT_ENABLED=true                      # Activer le rate limiting global
RATE_LIMIT_RPM=60                            # Requetes par minute (API generale, prod: 60)
RATE_LIMIT_CVD_RPM=5                         # Requetes par minute (CVD public, prod: 5)

# --- Email / SMTP ---
EMAIL_ENABLED=false                          # Activer l'envoi d'emails
EMAIL_FROM=noreply@srpdesk.com               # Adresse expediteur
SMTP_HOST=                                   # Serveur SMTP (ex: smtp.gmail.com)
SMTP_PORT=587                                # Port SMTP
SMTP_USERNAME=                               # Utilisateur SMTP
SMTP_PASSWORD=                               # Mot de passe SMTP
SMTP_AUTH=false                              # Authentification SMTP requise
SMTP_STARTTLS=true                           # Activer STARTTLS

# --- CRA (notifications & escalation) ---
CRA_NOTIFICATION_CHECK_MS=900000             # Intervalle verif notifications (ms, defaut: 15 min)
CRA_ESCALATION_CHECK_MS=300000               # Intervalle verif escalation (ms, defaut: 5 min)
CRA_ALERT_EMAIL=                             # Email alertes CRA
CRA_ESCALATION_EMAIL=                        # Email escalation CRA

# --- ENISA SRP ---
ENISA_ENABLED=false                          # Activer le connecteur ENISA SRP
ENISA_BASE_URL=https://srp.enisa.europa.eu
ENISA_API_KEY=                               # Cle API ENISA
ENISA_TIMEOUT=30                             # Timeout secondes

# --- CSIRT national (Art. 14) ---
CSIRT_ENABLED=false                          # Activer la notification CSIRT parallele
CSIRT_BASE_URL=                              # URL de l'API CSIRT nationale
CSIRT_API_KEY=                               # Cle API CSIRT
CSIRT_TIMEOUT=30                             # Timeout secondes
CSIRT_COUNTRY_CODE=FR                        # Code pays ISO (defaut: FR)

# --- Monitoring vulnerabilites (OSV) ---
MONITORING_INTERVAL_MS=21600000              # Intervalle de scan (ms, defaut: 6h)
OSV_BASE_URL=https://api.osv.dev
OSV_BATCH_SIZE=100                           # Taille des lots OSV
OSV_RATE_LIMIT_MS=1000                       # Pause entre lots (ms)

# --- CVD (Coordinated Vulnerability Disclosure) ---
CVD_CONTACT_EMAIL=security@srpdesk.com       # Email de contact securite (security.txt)

# --- Support end-of-life monitoring ---
SUPPORT_MONITOR_WARNING_DAYS=90              # Jours avant fin de support pour alerter

# --- AI / Ollama ---
AI_ENABLED=false                             # Activer l'assistant IA
OLLAMA_BASE_URL=http://ollama:11434          # URL du serveur Ollama
OLLAMA_MODEL=phi3.5                          # Modele LLM
OLLAMA_TEMPERATURE=0.2                       # Temperature (0.0-1.0)
OLLAMA_TOP_P=0.9                             # Top-P sampling
OLLAMA_NUM_CTX=4096                          # Taille du contexte (tokens)
OLLAMA_TIMEOUT=120                           # Timeout secondes
AI_RATE_LIMIT_RPM=10                         # Requetes IA par minute

# --- Webhooks & integrations ---
GITHUB_WEBHOOK_SECRET=                       # Secret HMAC-SHA256 webhook GitHub
GITLAB_WEBHOOK_SECRET=                       # Secret webhook GitLab

# --- API Keys ---
API_KEY_PREFIX=srpd_                         # Prefixe des cles API generees
API_KEY_LENGTH=20
cc                                                 # Longueur aleatoire des cles (octets)
API_KEY_SCOPES=ci:sbom                       # Scopes par defaut

# --- SBOM ---
SBOM_MAX_SIZE_MB=10                          # Taille max SBOM uploade (MB)

# --- Feature flags backend ---
EXTRAS_REQUIREMENTS_ENABLED=false            # CRA checklist module
EXTRAS_QUESTIONNAIRE_ENABLED=false           # AI questionnaire module

# --- Observabilite (OpenTelemetry) ---
OTEL_SAMPLING_PROBABILITY=1.0               # Probabilite sampling traces (0.0-1.0, prod: 1.0)
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces  # Endpoint OTLP collector

# --- JVM tuning ---
JAVA_OPTS=                                   # Options JVM (ex: -Xms512m -Xmx1g -XX:+UseG1GC)

# ============================================================================
# Frontend (variables build-time Vite)
# ============================================================================
VITE_KEYCLOAK_URL=https://auth.srpdesk.com
VITE_KEYCLOAK_REALM=srpdesk
VITE_KEYCLOAK_CLIENT_ID=frontend
VITE_API_URL=/api/v1                         # URL de base API (defaut: /api/v1 via proxy nginx)
VITE_FEATURE_REQUIREMENTS=false              # Activer le module CRA checklist (frontend)
VITE_FEATURE_AI_QUESTIONNAIRE=false          # Activer le module questionnaire IA (frontend)

# ============================================================================
# Docker Compose operationnel
# ============================================================================
POSTGRES_MEMORY_LIMIT=512m                   # Limite memoire conteneur PostgreSQL
KEYCLOAK_MEMORY_LIMIT=768m                   # Limite memoire conteneur Keycloak
MINIO_MEMORY_LIMIT=256m                      # Limite memoire conteneur MinIO
BACKEND_MEMORY_LIMIT=768m                    # Limite memoire conteneur backend
CADDY_MEMORY_LIMIT=128m                      # Limite memoire conteneur Caddy
PROMETHEUS_MEMORY_LIMIT=256m                 # Limite memoire conteneur Prometheus
BACKUP_MEMORY_LIMIT=128m                     # Limite memoire conteneur backup

# ============================================================================
# Sauvegarde & monitoring
# ============================================================================
BACKUP_CRON=0 2 * * *                        # Cron sauvegarde PostgreSQL (defaut: 2h00 chaque jour)
BACKUP_RETENTION_DAYS=30                     # Retention des sauvegardes (jours)
PROMETHEUS_RETENTION=15d                     # Retention des metriques Prometheus
