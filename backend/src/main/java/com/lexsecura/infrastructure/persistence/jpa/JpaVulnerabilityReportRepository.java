package com.lexsecura.infrastructure.persistence.jpa;

import com.lexsecura.infrastructure.persistence.entity.VulnerabilityReportEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

import java.util.List;
import java.util.Optional;
import java.util.UUID;

public interface JpaVulnerabilityReportRepository extends JpaRepository<VulnerabilityReportEntity, UUID> {

    Optional<VulnerabilityReportEntity> findByIdAndOrgId(UUID id, UUID orgId);

    Optional<VulnerabilityReportEntity> findByTrackingId(String trackingId);

    List<VulnerabilityReportEntity> findAllByOrgIdOrderByCreatedAtDesc(UUID orgId);

    List<VulnerabilityReportEntity> findAllByOrgIdAndStatusOrderByCreatedAtDesc(UUID orgId, String status);

    long countByOrgIdAndStatus(UUID orgId, String status);

    @Query(value = "SELECT nextval('vr_tracking_seq')", nativeQuery = true)
    long nextTrackingSequence();
}
