package com.lexsecura.infrastructure.persistence.entity;

import jakarta.persistence.*;
import java.math.BigDecimal;
import java.time.Instant;
import java.util.UUID;

@Entity
@Table(name = "vulnerability_reports")
public class VulnerabilityReportEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private UUID id;

    @Column(name = "org_id", nullable = false)
    private UUID orgId;

    @Column(name = "product_id")
    private UUID productId;

    @Column(name = "tracking_id", nullable = false, unique = true, length = 20)
    private String trackingId;

    @Column(nullable = false, length = 30)
    private String status;

    @Column(name = "reporter_name", length = 255)
    private String reporterName;

    @Column(name = "reporter_email", length = 500)
    private String reporterEmail;

    @Column(name = "reporter_pgp_fingerprint", length = 100)
    private String reporterPgpFingerprint;

    @Column(name = "is_anonymous", nullable = false)
    private boolean anonymous;

    @Column(nullable = false, length = 500)
    private String title;

    @Column(nullable = false, columnDefinition = "TEXT")
    private String description;

    @Column(name = "severity_estimate", length = 20)
    private String severityEstimate;

    @Column(name = "affected_component", length = 500)
    private String affectedComponent;

    @Column(name = "affected_versions", length = 500)
    private String affectedVersions;

    @Column(name = "steps_to_reproduce", columnDefinition = "TEXT")
    private String stepsToReproduce;

    @Column(name = "proof_of_concept", columnDefinition = "TEXT")
    private String proofOfConcept;

    @Column(name = "assigned_to")
    private UUID assignedTo;

    @Column(name = "internal_notes", columnDefinition = "TEXT")
    private String internalNotes;

    @Column(name = "internal_severity", length = 20)
    private String internalSeverity;

    @Column(name = "cvss_score", precision = 3, scale = 1)
    private BigDecimal cvssScore;

    @Column(name = "cve_id", length = 30)
    private String cveId;

    @Column(name = "submitted_at", nullable = false)
    private Instant submittedAt;

    @Column(name = "acknowledged_at")
    private Instant acknowledgedAt;

    @Column(name = "triaged_at")
    private Instant triagedAt;

    @Column(name = "fixed_at")
    private Instant fixedAt;

    @Column(name = "disclosed_at")
    private Instant disclosedAt;

    @Column(name = "disclosure_deadline")
    private Instant disclosureDeadline;

    @Column(name = "created_at", nullable = false, updatable = false)
    private Instant createdAt;

    @Column(name = "updated_at", nullable = false)
    private Instant updatedAt;

    @PrePersist
    void prePersist() {
        Instant now = Instant.now();
        if (createdAt == null) createdAt = now;
        if (updatedAt == null) updatedAt = now;
        if (submittedAt == null) submittedAt = now;
    }

    @PreUpdate
    void preUpdate() {
        updatedAt = Instant.now();
    }

    // Getters & Setters
    public UUID getId() { return id; }
    public void setId(UUID id) { this.id = id; }
    public UUID getOrgId() { return orgId; }
    public void setOrgId(UUID orgId) { this.orgId = orgId; }
    public UUID getProductId() { return productId; }
    public void setProductId(UUID productId) { this.productId = productId; }
    public String getTrackingId() { return trackingId; }
    public void setTrackingId(String trackingId) { this.trackingId = trackingId; }
    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }
    public String getReporterName() { return reporterName; }
    public void setReporterName(String reporterName) { this.reporterName = reporterName; }
    public String getReporterEmail() { return reporterEmail; }
    public void setReporterEmail(String reporterEmail) { this.reporterEmail = reporterEmail; }
    public String getReporterPgpFingerprint() { return reporterPgpFingerprint; }
    public void setReporterPgpFingerprint(String reporterPgpFingerprint) { this.reporterPgpFingerprint = reporterPgpFingerprint; }
    public boolean isAnonymous() { return anonymous; }
    public void setAnonymous(boolean anonymous) { this.anonymous = anonymous; }
    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }
    public String getDescription() { return description; }
    public void setDescription(String description) { this.description = description; }
    public String getSeverityEstimate() { return severityEstimate; }
    public void setSeverityEstimate(String severityEstimate) { this.severityEstimate = severityEstimate; }
    public String getAffectedComponent() { return affectedComponent; }
    public void setAffectedComponent(String affectedComponent) { this.affectedComponent = affectedComponent; }
    public String getAffectedVersions() { return affectedVersions; }
    public void setAffectedVersions(String affectedVersions) { this.affectedVersions = affectedVersions; }
    public String getStepsToReproduce() { return stepsToReproduce; }
    public void setStepsToReproduce(String stepsToReproduce) { this.stepsToReproduce = stepsToReproduce; }
    public String getProofOfConcept() { return proofOfConcept; }
    public void setProofOfConcept(String proofOfConcept) { this.proofOfConcept = proofOfConcept; }
    public UUID getAssignedTo() { return assignedTo; }
    public void setAssignedTo(UUID assignedTo) { this.assignedTo = assignedTo; }
    public String getInternalNotes() { return internalNotes; }
    public void setInternalNotes(String internalNotes) { this.internalNotes = internalNotes; }
    public String getInternalSeverity() { return internalSeverity; }
    public void setInternalSeverity(String internalSeverity) { this.internalSeverity = internalSeverity; }
    public BigDecimal getCvssScore() { return cvssScore; }
    public void setCvssScore(BigDecimal cvssScore) { this.cvssScore = cvssScore; }
    public String getCveId() { return cveId; }
    public void setCveId(String cveId) { this.cveId = cveId; }
    public Instant getSubmittedAt() { return submittedAt; }
    public void setSubmittedAt(Instant submittedAt) { this.submittedAt = submittedAt; }
    public Instant getAcknowledgedAt() { return acknowledgedAt; }
    public void setAcknowledgedAt(Instant acknowledgedAt) { this.acknowledgedAt = acknowledgedAt; }
    public Instant getTriagedAt() { return triagedAt; }
    public void setTriagedAt(Instant triagedAt) { this.triagedAt = triagedAt; }
    public Instant getFixedAt() { return fixedAt; }
    public void setFixedAt(Instant fixedAt) { this.fixedAt = fixedAt; }
    public Instant getDisclosedAt() { return disclosedAt; }
    public void setDisclosedAt(Instant disclosedAt) { this.disclosedAt = disclosedAt; }
    public Instant getDisclosureDeadline() { return disclosureDeadline; }
    public void setDisclosureDeadline(Instant disclosureDeadline) { this.disclosureDeadline = disclosureDeadline; }
    public Instant getCreatedAt() { return createdAt; }
    public void setCreatedAt(Instant createdAt) { this.createdAt = createdAt; }
    public Instant getUpdatedAt() { return updatedAt; }
    public void setUpdatedAt(Instant updatedAt) { this.updatedAt = updatedAt; }
}
